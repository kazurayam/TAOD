== Test2: Write an image with Metadata (source URL)

=== T2MetadataTest

I will show you next sample code `test02_write_image_with_metadata` of `T2MetadataTest` class.

[source, text]
.T2MetadataTest
----
include::../src/test/java/my/sample/T2MetadataTest.java[lines=33..60]
----

At the statement (10), we create an instance of `java.net.URL` with a String link:https://kazurayam.github.io/materialstore/images/tutorial/03_apple.png[]. You can click this URL to see the image yourself: a red apple.

I create a helper class named `my.sample.SharedMethod` with a method `createURL(String)` that instanciate an instance of `URL`.

[source, text]
.createURL(String)
----
include::../src/test/java/my/sample/SharedMethods.java[lines=18..24]
----

At the statement (11) we get access to the URL. We will effectively download a PNG image file from the URL and obtain a large byte array.
The `downloadURL(URL)` method of `SharedMethods` class implements this processing: converting a URL to an array of bytes.

[source,text]
.downloadUrl(URL)
----
include::../src/test/java/my/sample/SharedMethods.java[lines=26..40]
----

The statement (12) invokes `store.write()` method, which create a new file tree, as this:

image::images/tutorial/07_writing_image_with_metadata.png[]

the `index` file contains a single line of text, which is something like:

[source,text]
.index
----
27b2d39436d0655e7e8885c7f2a568a646164280	png	{"step":"01", "URL.host":"kazurayam.github.io", "URL.path":"/materialstore/images/tutorial/03_apple.png", "URL.port":"80", "URL.protocol":"https"}
----

Here you can see a JSON-like string which contains several **key:value** pairs. I would call this section as **Metadata** of a material. The metadata was created as specified by the line (13).
[source,text]
----
        Metadata.builder(url).put("step", "01") // (13)
                .build(),
----

The `url` variable is an instance of `java.net.URL`. You should check the https://docs.oracle.com/javase/7/docs/api/java/net/URL.html[Javadoc of `URL`]. The constructor `new URL(String spec)` can accept a string "https://kazurayam.github.io/materialstore/images/tutorial/03_apple.png[]" and parse it to its components: `protocol`, `host`, `port`, `path`, `query` and `fragment`. The `url` variable passed to the `Metadata.builder(url)` call is parsed by the URL class and transformed into key-value pair `"URL.hostname": "kazurayam.github.io"` and others.

Also the line (13) explicitly created a key:value pair: `"step": "01"`. You can create as many as key:value pairs. Both of key and value must be String (no number, no boolean, no null). The key can be any string. Also the value can be any string. You can use any characters including `/` (forward slash), `\` (back slash), `:` (colon). You can use non-ascii characters, of course. For example: you can create a key-value pair `"通番": "壱"`. You can create any key-value pairs as you like.

You can create any key-value pairs (Metadata) as you like and associate it to the individual material objects. The metadata is stored in the `index` file, which is apart from the material file itself. The image file downloaded from URL is not altered at all. The image is saved as is into the `objects` directory. Adding to it, you can associate a rich set of Metadata with each individual materials. What sort of Metadata to associate? --- it is completely up to you.




