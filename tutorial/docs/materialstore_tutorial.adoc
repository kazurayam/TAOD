== Materialstore Tutorial

Let us begin with a quick introduction to a Java library named "materialstore".

=== Setting up a project

Here I assume you have a seasoned programming skill in Java, and you have installed the build tool link:https://gradle.org/install/[Gradle]. Now let us create a project where you write some Java code for practice.

You would want to initialize it as a Gradle application project. Let me assume the project is named as "sampleProject".

[source, shell]
```
$ cd ~/tmp/
$ mkdir sampleProject
```

You would operate in the console as this:

[source, shell]
----
$ cd ~/tmp/sampleProject
$ gradle init

Select type of project to generate:
  1: basic
  2: application
  3: library
  4: Gradle plugin
Enter selection (default: basic) [1..4] 1

Select build script DSL:
  1: Groovy
  2: Kotlin
Enter selection (default: Groovy) [1..2] 1

Generate build using new APIs and behavior (some features may change in the next minor release)? (default

Project name (default: sampleProject):

> Task :init
Get more help with your project: Learn more about Gradle by exploring our samples at https://docs.gradle.org/7.4.2/samples

BUILD SUCCESSFUL in 28s

----

Then you will find a file `sampleProject/settings.gradle` has been created, which looks like:

[source, gradle]
----
rootProject.name = 'sampleProject'
----

You will also find a file `sampleProject/build.gradle` file, but it will be empty (comments only). So you want to edit it, like this.

[source, gradle]
----
include::../build.gradle[lines=1..30]
----

Please note that here you declared the dependency to the `materialstore` library.

You can check if the project is properly setup by executing a command:

[source]
----
$ cd ~/sampleProject/
$ gradle dependencies --configuration testImplementation

------------------------------------------------------------
Root project 'sampleProject'
------------------------------------------------------------

testImplementation - Implementation only dependencies for source set 'test'. (n)
+--- com.kazurayam:materialstore:0.12.5 (n)
+--- org.slf4j:slf4j-api:1.7.25 (n)
+--- org.slf4j:slf4j-simple:1.7.25 (n)
\--- org.junit.jupiter:junit-jupiter-api:5.9.0 (n)

(n) - Not resolved (configuration is not meant to be resolved)

A web-based, searchable dependency report is available by adding the --scan option.

BUILD SUCCESSFUL in 1s
1 actionable task: 1 executed
----

=== The first test : "Hello, materialstore!"


I have created a JUnit-based code that uses the materialstore library. See `sampleProject/app/src/test/java/my/sample/T1HelloMaterialstoreTest.java`:

[source, java]
----
include::../src/test/java/my/sample/T1HelloMaterialstoreTest.java[]
----

I can ran this test by running Gradle's `test` task, as this:

[source]
----
$ gradle test
> Task :compileJava NO-SOURCE
> Task :processResources NO-SOURCE
> Task :classes UP-TO-DATE
> Task :compileTestJava
> Task :processTestResources NO-SOURCE
> Task :testClasses
> Task :test

BUILD SUCCESSFUL in 2s
2 actionable tasks: 2 executed
----

The `test` task of Gradle will create a report in HTML format where you can all output from the test execution. Find the `build/reports/tests/test/index.html` file as:

```
$ cd ~/tmp/sampleProject
$ tree build/reports/tests/
build/reports/tests/
└── test
    ├── classes
    │   └── my.sample.T1HelloMaterialstoreTest.html
    ├── css
    │   ├── base-style.css
    │   └── style.css
    ├── index.html
    ├── js
    │   └── report.js
    └── packages
        └── my.sample.html

5 directories, 6 files
```

You can open the `index.html` in browser and see the test result.

image::images/01_test_report.png[]

=== Understanding the basics

Let us read the source of the "Hello, materialstore!" test line by line to understand the fundamentals of the materialstore library.

Here are assume that you are a well-trained Java programmer and you do not need any explanation how to write test using JUnit 5 Jupiter.

[source, text]
----
    @BeforeEach
    public void beforeEach() {
        Path dir = createTestClassOutputDir(this);   // (1)
----

The statement commented as (1) creates a directory `build/tmp/testOutput/my.sample.T1HellowMaterialstoreTest`. In this directory the test will output everything during its run. The helper method `createTestClassOutputDir(Object)` is defined later in the source file.


[source, text]
----
        Path storeDir = dir.resolve("store");   // (2)
----

The statement commented as (2) declares a new directory named `store` under the working directory created at (1).


[source, text]
----
import com.kazurayam.materialstore.core.filesystem.Store;
...

    private Store store;
...

        store = Stores.newInstance(storeDir);        // (3)
----

The statement commented as (3) instantiates an object of `com.kazurayam.materialstore.core.filesystem.Store` class. The `Store` class is the central entry point of the materialstore library. The `Store` class implements methods to write "materials" into the store with various metadata, and methods to select one or more materials out of the store.

